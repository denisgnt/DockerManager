# Cache Manager Documentation

## ะะฑะทะพั

ะกะธััะตะผะฐ ะบะตัะธัะพะฒะฐะฝะธั ะธัะฟะพะปัะทัะตั ะฑะธะฑะปะธะพัะตะบั `node-cache` ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั ะฒ ะฟะฐะผััะธ ั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะฟะตััะธััะตะฝัะฝะพัััั ะฒ ัะฐะนะปะพะฒัั ัะธััะตะผั. ะญัะพ ะพะฑะตัะฟะตัะธะฒะฐะตั:

- โก **ะัััััะน ะดะพัััะฟ**: ะดะฐะฝะฝัะต ััะฐะฝัััั ะฒ ะฟะฐะผััะธ ะดะปั ะผะณะฝะพะฒะตะฝะฝะพะณะพ ััะตะฝะธั
- ๐พ **ะะตััะธััะตะฝัะฝะพััั**: ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะพััะฐะฝะตะฝะธะต ะฒ ัะฐะนะปั ะฟัะธ ะบะฐะถะดะพะผ ะพะฑะฝะพะฒะปะตะฝะธะธ
- ๐ **ะะพัััะฐะฝะพะฒะปะตะฝะธะต**: ะดะฐะฝะฝัะต ะทะฐะณััะถะฐัััั ะธะท ัะฐะนะปะพะฒ ะฟัะธ ััะฐััะต ัะตัะฒะตัะฐ
- ๐ **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**: ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝะฐั ัะฐะฑะพัะฐ ั ะฑะพะปััะธะผะธ ะพะฑัะตะผะฐะผะธ ะดะฐะฝะฝัั

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     Memory Cache (node-cache)       โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ โ
โ  โ  Containers  โ  โ Node Positionsโ โ
โ  โ    Cache     โ  โ    Cache      โ โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ    File System (persistence)        โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ โ
โ  โcontainers.jsonโ โnode-positionsโ โ
โ  โ              โ  โ   .json      โ โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ โ
โ  data/cache/                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะฃััะฐะฝะพะฒะปะตะฝะฝัะต ะฑะธะฑะปะธะพัะตะบะธ

```json
{
  "node-cache": "^5.1.2"
}
```

## ะคะฐะนะปะพะฒะฐั ััััะบัััะฐ

```
server/
  โโโ cacheManager.js       # ะะพะดัะปั ัะฟัะฐะฒะปะตะฝะธั ะบะตัะตะผ
  โโโ index.js              # ะัะฟะพะปัะทะพะฒะฐะฝะธะต cache manager

data/
  โโโ cache/
      โโโ containers.json      # ะะตััะธััะตะฝัะฝะพะต ััะฐะฝะธะปะธัะต ะบะพะฝัะตะนะฝะตัะพะฒ
      โโโ node-positions.json  # ะะตััะธััะตะฝัะฝะพะต ััะฐะฝะธะปะธัะต ะฟะพะทะธัะธะน ัะทะปะพะฒ
```

## API Cache Manager

### ContainersCacheManager

#### `getAll()`
ะะพะปััะธัั ะฒัะต ะบะพะฝัะตะนะฝะตัั ะธะท ะบะตัะฐ ะฟะฐะผััะธ.

```javascript
const containers = await ContainersCacheManager.getAll();
// ะะพะทะฒัะฐัะฐะตั: Array<Container> ะธะปะธ []
```

#### `saveContainers(containers)`
ะกะพััะฐะฝะธัั ะบะพะฝัะตะนะฝะตัั ั ะผะตัะดะถะตะผ ัััะตััะฒัััะธั ะดะฐะฝะฝัั.

```javascript
await ContainersCacheManager.saveContainers([
  { Id: '123', Names: ['/container1'], State: 'running' }
]);
```

**ะคัะฝะบัะธะพะฝะฐะป:**
- ะะฐะณััะถะฐะตั ัััะตััะฒัััะธะน ะบะตั
- ะกะพะทะดะฐะตั Map ะฟะพ ะธะผะตะฝะฐะผ ะบะพะฝัะตะนะฝะตัะพะฒ
- ะะตัะดะถะธั ะฝะพะฒัะต ะดะฐะฝะฝัะต ั ัััะตััะฒัััะธะผะธ
- ะกะพััะฐะฝัะตั ะฒ ะฟะฐะผััั ะ ะฒ ัะฐะนะป

#### `updateCache(containers)`
ะะพะปะฝะพัััั ะพะฑะฝะพะฒะธัั ะบะตั (ะฑะตะท ะผะตัะดะถะฐ).

```javascript
await ContainersCacheManager.updateCache(containersArray);
```

#### `clear()`
ะัะธััะธัั ะฒะตัั ะบะตั ะบะพะฝัะตะนะฝะตัะพะฒ.

```javascript
await ContainersCacheManager.clear();
```

### NodePositionsCacheManager

#### `getPositions()`
ะะพะปััะธัั ะฟะพะทะธัะธะธ ัะทะปะพะฒ ะธะท ะบะตัะฐ.

```javascript
const positions = await NodePositionsCacheManager.getPositions();
// ะะพะทะฒัะฐัะฐะตั: { [nodeId]: { x: number, y: number } } ะธะปะธ {}
```

#### `savePositions(positions)`
ะกะพััะฐะฝะธัั ะฟะพะทะธัะธะธ ัะทะปะพะฒ.

```javascript
await NodePositionsCacheManager.savePositions({
  'container-123': { x: 100, y: 200 },
  'container-456': { x: 300, y: 400 }
});
```

#### `reset()`
ะกะฑัะพัะธัั ะฒัะต ะฟะพะทะธัะธะธ ัะทะปะพะฒ.

```javascript
await NodePositionsCacheManager.reset();
```

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ ะบะพะดะต

### ะะผะฟะพัั

```javascript
import { ContainersCacheManager, NodePositionsCacheManager } from './cacheManager.js';
```

### ะัะธะผะตั: ะกะพััะฐะฝะตะฝะธะต ะบะพะฝัะตะนะฝะตัะพะฒ

```javascript
// ะะพะปััะธัั ะดะฐะฝะฝัะต ะธะท Docker API
const containers = await dockerRequest('/containers/json?all=true');

// ะะพะฑะฐะฒะธัั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะธะฝัะพัะผะฐัะธั
const enrichedContainers = await Promise.all(
  containers.map(async (container) => {
    const inspect = await dockerRequest(`/containers/${container.Id}/json`);
    return { ...container, Env: inspect.Config.Env };
  })
);

// ะกะพััะฐะฝะธัั ะฒ ะบะตั (ะฐะฒัะพะผะฐัะธัะตัะบะธ ะผะตัะดะถะธััั ั ัััะตััะฒัััะธะผะธ)
await ContainersCacheManager.saveContainers(enrichedContainers);
```

### ะัะธะผะตั: ะะฐะณััะทะบะฐ ะธะท ะบะตัะฐ

```javascript
// ะัะธ ะฝะตะดะพัััะฟะฝะพััะธ Docker API - ะธัะฟะพะปัะทัะตะผ ะบะตั
try {
  const containers = await dockerRequest('/containers/json?all=true');
  return containers;
} catch (error) {
  console.log('Docker unavailable, using cache');
  return await ContainersCacheManager.getAll();
}
```

### ะัะธะผะตั: ะะฐะฑะพัะฐ ั ะฟะพะทะธัะธัะผะธ ัะทะปะพะฒ

```javascript
// ะะพะปััะธัั ัะตะบััะธะต ะฟะพะทะธัะธะธ
app.get('/api/graph/positions', async (req, res) => {
  const positions = await NodePositionsCacheManager.getPositions();
  res.json(positions);
});

// ะกะพััะฐะฝะธัั ะฝะพะฒัะต ะฟะพะทะธัะธะธ
app.post('/api/graph/positions', async (req, res) => {
  const result = await NodePositionsCacheManager.savePositions(req.body);
  res.json(result);
});

// ะกะฑัะพัะธัั ะฟะพะทะธัะธะธ
app.delete('/api/graph/positions', async (req, res) => {
  const result = await NodePositionsCacheManager.reset();
  res.json(result);
});
```

## ะัะพะฑะตะฝะฝะพััะธ ัะตะฐะปะธะทะฐัะธะธ

### 1. ะะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐะณััะทะบะฐ ะฟัะธ ััะฐััะต

ะัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะผะพะดัะปั ะดะฐะฝะฝัะต ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะณััะถะฐัััั ะธะท ัะฐะนะปะพะฒ:

```javascript
// ะัะฟะพะปะฝัะตััั ะฟัะธ ะธะผะฟะพััะต ะผะพะดัะปั
await loadFromFile(CONTAINERS_CACHE_FILE, containersCache, 'containers-list');
await loadFromFile(NODE_POSITIONS_FILE, nodePositionsCache, 'node-positions');
```

### 2. ะะฒะพะนะฝะพะต ัะพััะฐะฝะตะฝะธะต

ะะฐะถะดะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพััะฐะฝัะตััั ะฒ ะพะฑะพะธั ะผะตััะฐั:

```javascript
// 1. ะกะพััะฐะฝะตะฝะธะต ะฒ memory cache (ะฑััััะพ)
containersCache.set('containers-list', mergedCache);

// 2. ะกะพััะฐะฝะตะฝะธะต ะฒ ัะฐะนะป (ะฟะตััะธััะตะฝัะฝะพััั)
await saveToFile(CONTAINERS_CACHE_FILE, mergedCache);
```

### 3. ะะตัะดะถ ัััะฐัะตะณะธั ะดะปั ะบะพะฝัะตะนะฝะตัะพะฒ

ะัะธ ัะพััะฐะฝะตะฝะธะธ ะบะพะฝัะตะนะฝะตัะพะฒ ะธัะฟะพะปัะทัะตััั ะธะฝัะตะปะปะตะบััะฐะปัะฝัะน ะผะตัะดะถ:

- ะกััะตััะฒัััะธะต ะบะพะฝัะตะนะฝะตัั ะพะฑะฝะพะฒะปััััั
- ะะพะฒัะต ะบะพะฝัะตะนะฝะตัั ะดะพะฑะฐะฒะปััััั
- ะฃะดะฐะปะตะฝะฝัะต ะบะพะฝัะตะนะฝะตัั ัะพััะฐะฝััััั ั ะผะตัะฐะดะฐะฝะฝัะผะธ ะธะท ะบะตัะฐ

### 4. ะะฐัััะพะนะบะธ node-cache

```javascript
new NodeCache({ 
  stdTTL: 0,        // ะะตัััะพัะฝะพะต ััะฐะฝะตะฝะธะต (ะฝะตั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะดะฐะปะตะฝะธั)
  checkperiod: 0,   // ะะต ะฟัะพะฒะตัััั ะธััะตัะตะฝะธะต TTL
  useClones: false  // ะะต ะบะปะพะฝะธัะพะฒะฐัั ะพะฑัะตะบัั (ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั)
});
```

โ๏ธ **ะะฐะถะฝะพ**: `useClones: false` ะพะทะฝะฐัะฐะตั, ััะพ ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะพะฑัะตะบัะฐ ะธะท ะบะตัะฐ ะธะทะผะตะฝัะตััั ะพัะธะณะธะฝะฐะป. ะัะดััะต ะพััะพัะพะถะฝั ั ะผััะฐัะธัะผะธ.

## ะัะตะธะผััะตััะฒะฐ ัะตัะตะฝะธั

### โ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- ะงัะตะฝะธะต ะดะฐะฝะฝัั ะธะท ะฟะฐะผััะธ (ะผะธะบัะพัะตะบัะฝะดั)
- ะะตั ะฑะปะพะบะธัะพะฒะพะบ I/O ะฟัะธ ััะตะฝะธะธ

### โ ะะฐะดะตะถะฝะพััั
- ะะฐะฝะฝัะต ัะพััะฐะฝััััั ะฟัะธ ะบะฐะถะดะพะผ ะพะฑะฝะพะฒะปะตะฝะธะธ
- ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะฟะพัะปะต ะฟะตัะตะทะฐะฟััะบะฐ

### โ ะัะพััะพัะฐ
- ะัะพััะพะน API
- ะะธะฝะธะผะฐะปัะฝัะต ะทะฐะฒะธัะธะผะพััะธ
- ะะตะณะบะฐั ะพัะปะฐะดะบะฐ

### โ ะะธะฑะบะพััั
- ะะตะณะบะพ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะต ะบะตัะธ
- ะะฐัััะฐะธะฒะฐะตะผัะต TTL
- ะะฐััะพะผะฝะฐั ะปะพะณะธะบะฐ ะผะตัะดะถะฐ

## ะะธะณัะฐัะธั ัะพ ััะฐัะพะน ัะธััะตะผั

ะะพ ะฒะฝะตะดัะตะฝะธั cache manager ะธัะฟะพะปัะทะพะฒะฐะปะธัั ะฟััะผัะต ะพะฟะตัะฐัะธะธ ั ัะฐะนะปะฐะผะธ:

```javascript
// ะกัะฐััะน ะฟะพะดัะพะด โ
const data = await readFile(CONTAINERS_CACHE_FILE, 'utf-8');
const containers = JSON.parse(data);

// ะะพะฒัะน ะฟะพะดัะพะด โ
const containers = await ContainersCacheManager.getAll();
```

### ะงัะพ ะธะทะผะตะฝะธะปะพัั ะฒ index.js

1. **ะะผะฟะพััั**: ะดะพะฑะฐะฒะปะตะฝ cache manager
2. **ะะพะฝััะฐะฝัั**: ัะดะฐะปะตะฝั ะฟััะธ ะบ ัะฐะนะปะฐะผ (ัะตะฟะตัั ะฒ cache manager)
3. **ะคัะฝะบัะธะธ**: ัะฟัะพัะตะฝั ัะตัะตะท ะธัะฟะพะปัะทะพะฒะฐะฝะธะต cache manager API
4. **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ**: ัะตะฝััะฐะปะธะทะพะฒะฐะฝะฐ ะฒ cache manager

## ะะพะฝะธัะพัะธะฝะณ ะธ ะพัะปะฐะดะบะฐ

### ะะพะณะธ

Cache manager ะฒัะฒะพะดะธั ะธะฝัะพัะผะฐัะธะฒะฝัะต ะปะพะณะธ:

```
โ Loaded containers-list from file into memory cache
โ Loaded node-positions from file into memory cache
โ Cached 15 containers (3 new/updated)
โ Node positions saved to cache
โ Containers cache updated successfully
```

### ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ะบะตัะฐ

```javascript
// ะะพะปััะธัั ััะฐัะธััะธะบั
const containers = await ContainersCacheManager.getAll();
console.log(`Cached containers: ${containers.length}`);

const positions = await NodePositionsCacheManager.getPositions();
console.log(`Saved positions: ${Object.keys(positions).length}`);
```

## ะัะดััะธะต ัะปัััะตะฝะธั

- [ ] ะะพะฑะฐะฒะธัั TTL ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพัะธััะบะธ ัััะฐัะตะฒัะธั ะดะฐะฝะฝัั
- [ ] ะะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ะบะตัะฐ (hits/misses)
- [ ] ะกะถะฐัะธะต ะดะฐะฝะฝัั ะดะปั ะฑะพะปััะธั ะบะตัะตะน
- [ ] ะะฟัะธะพะฝะฐะปัะฝะฐั ัะตะฟะปะธะบะฐัะธั ะบะตัะฐ
- [ ] ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะบะตัะตะผ

## Troubleshooting

### ะะตั ะฝะต ะทะฐะณััะถะฐะตััั ะฟัะธ ััะฐััะต

ะัะพะฒะตัััะต ะฟัะฐะฒะฐ ะดะพัััะฟะฐ ะบ ะดะธัะตะบัะพัะธะธ `data/cache/` ะธ ะฝะฐะปะธัะธะต JSON ัะฐะนะปะพะฒ.

### ะะฐะฝะฝัะต ะฝะต ัะพััะฐะฝััััั

ะฃะฑะตะดะธัะตัั, ััะพ ะฟัะพัะตัั ะธะผะตะตั ะฟัะฐะฒะฐ ะฝะฐ ะทะฐะฟะธัั ะฒ `data/cache/`:

```bash
chmod -R 755 data/cache/
```

### ะะตั ะฟะพัะตััะปัั ะฟะพัะปะต ะฟะตัะตะทะฐะฟััะบะฐ

ะัะพะฒะตัััะต, ััะพ ัะฐะนะปั ะฝะต ะฑัะปะธ ัะดะฐะปะตะฝั ะธ ัะพัะผะฐั JSON ะบะพััะตะบัะตะฝ.

---

**ะะฒัะพั**: Cache Manager System  
**ะะตััะธั**: 1.0.0  
**ะะฐัะฐ**: 2 ะดะตะบะฐะฑัั 2025 ะณ.
